#include <iostream>
#include "NeuralNetwork.h"

float* createMnistDigit0Version1() {
    static float digit[28 * 28] = {
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0.2f,0.6f,0.6f,0.2f,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,1.0f,1.0f,1.0f,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,0.8f,0.6f,0.2f,0,0,0,0,0,0,0,0,0.2f,0.6f,0.8f,0.8f,0.2f,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,1.0f,1.0f,1.0f,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0.2f,0.6f,0.6f,0.2f,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    };
    return digit;
}

float* createMnistDigit0Version2() {
    static float digit[28 * 28] = {
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0.2f,0.6f,0.6f,0.2f,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,1.0f,1.0f,1.0f,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0,0.2f,0.8f,1.0f,0,0,0,0,0,0,0,0,0,0,1.0f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0,0.2f,0.8f,0.8f,0.6f,0.2f,0,0,0,0,0,0,0.2f,0.6f,0.8f,0.8f,0.2f,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0.2f,0.8f,1.0f,1.0f,1.0f,1.0f,1.0f,0.8f,0.2f,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0.2f,0.6f,0.6f,0.2f,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    };
    return digit;
}

void printMnistDigit(const float* data, int size = 28*28) {
    const char* shades = " .:-=+*#%@";
    for (int i = 0; i < size; ++i) {
        int shadeIndex = static_cast<int>(data[i] * 9); // data[i] is 0..1
        if (shadeIndex < 0) shadeIndex = 0;
        if (shadeIndex > 9) shadeIndex = 9;
        std::cout << shades[shadeIndex];
        if ((i + 1) % 28 == 0) std::cout << '\n';
    }
}

void setup() {
    float* trainData = createMnistDigit0Version1();
    printMnistDigit(trainData);
    createModel();
    for (size_t i = 0; i < 10; i++) {
        trainModel(trainData, 0);
    }

    float* testData = createMnistDigit0Version2();
    float* prediction = inference(testData);
    for (size_t i = 0; i < 10; i++) {
        std::cout << prediction[i];
        std::cout << std::endl;
    }
}

void loop() {
    
}

int main() {
    std::srand(std::time(nullptr));
    setup();
    loop();
    return 0;
}